<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        *{
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .box{
            margin: 0 auto;
            position: relative;
        }
        img{
            display: block;
            padding: 5px;
            border: 1px solid black;
        }
        li{
            float: left;
            margin: 10px 5px;
        }
    </style>
</head>
<body>
<div class="box">
    <ul>
        <li><a href="#"><img src="images/i1.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i2.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i3.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i4.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i5.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i6.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i7.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i8.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i9.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i10.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i11.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i12.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i13.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i14.jpg" alt=""></a></li>
        <li><a href="#"><img src="images/i15.jpg" alt=""></a></li>
    </ul>
</div>

<script src="../jquery-1.8.3.min.js"></script>
<script>
     /**
     * 1.获取页面宽度
     * 2.计算一行放几个
     * 3.计算每张的宽度
     * 4.获取第一行元素的高度
     * 5.获取最小高度的元素
     * 6.每次将新添加的元素放到最小高度里面
     * 7.更新最小高度
     *
     *
     *
     *  $(function(){})          DOM加载完毕
     *
     *  $(window).load(function(){})       网页中内容全部加载完毕
     */

     $(window).load(function(){
         (function(){

             function show(){
                 //1.获取页面宽度
                 var wWidth=$(window).width();

                 //2.获取第一张的宽度
                 var firstWidth=$('li:first').width()+10;

                 //3.计算一行最多放几个
                 var num=Math.floor(wWidth/firstWidth);

                 $('.box').css({
                     width:num*firstWidth

                 });

                 //4.获取第一行的元素
                 var firstRow=$('li:lt('+num+')');

                 //5.保存高度的数组
                 var arr=[];

                 //6.遍历第一行的li，将高度保存

                 firstRow.each(function(){

                     //7.保存高度
                     arr.push($(this).height());
                     $(this).css('position','static')
                 });

                 //8.获取第一行之外的li
                 var lis=$('li:gt('+(num-1)+')');

                 //9.遍历余下的元素
                 lis.each(function(){

                     //10获取最小高度
                     var minHeight=Math.min.apply(null,arr);

                     //11.获取最小高度元素的索引值
                     var index=arr.indexOf(minHeight);

                     //12.设置当前元素的位置
                     $(this).css({
                         position:'absolute',
                         left:index*firstWidth,
                         top:minHeight+10
                     });

                     //13.更新数组中最小高度的值
                     arr[index]+=$(this).height()+10;

                 });

             }

             show();

             //自定义模拟数据
             var imgData = {
                 "data": [{
                     "src": "images/i1.jpg"
                 }, {
                     "src": "images/i2.jpg"
                 }, {
                     "src": "images/i3.jpg"
                 }, {
                     "src": "images/i4.jpg"
                 }, {
                     "src": "images/i5.jpg"
                 }, {
                     "src": "images/i6.jpg"
                 }, {
                     "src": "images/i7.jpg"
                 }, {
                     "src": "images/i8.jpg"
                 }, {
                     "src": "images/i9.jpg"
                 }, {
                     "src": "images/i10.jpg"
                 }]
             };

             //滚动事件
             $(window).scroll(function(){

                 //获取滚动条位置
                 var sTop=$(this).scrollTop();

                 //获取最后一个元素
                 var last=$('li:last').offset().top-500;

                 //如果滚动条位置大于等于最后一个元素的位置就可以加载数据
                 if(sTop>=last){

                     console.log('到达了');
                     //声明一个变量保存HTML字符
                     var html='';

                     $.each(imgData.data,function(){

                         html+='<li><a href="#"><img src="'+this.src+'" alt=""></a></li>'

                     });

                     $('ul').append(html);

                     show();
                 }
             });

             $(window).resize(function(){
                 show();
             })


         })();
     })






</script>
</body>
</html>